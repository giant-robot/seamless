!function(a){"use strict";function b(b){this.config=a.extend(!0,{},this.defaults,b),this.cycle=0,this.items=[],this.$container=a(this.config.containerSelector),this.template=this.config.compileTemplate(this.config.template)}return"undefined"==typeof a&&"console"in window?window.console.info("Seamless needs jQuery."):"undefined"==typeof a.fn.waypoint&&"console"in window?window.console.info("Seamless needs jQuery.Waypoints."):(b.prototype.defaults={containerSelector:".container",itemSelector:".item",triggerSelector:".item:last",triggerOffset:"bottom-in-view",loadingClass:"is-loading",template:"",compileTemplate:function(a){return a},renderTemplate:function(a,b){},onAppend:function(a){},onComplete:function(a,b){},request:{paged:!1,offsetParam:"offset",offset:0,limitParam:"limit",limit:10},filterResponse:function(a){return a},dripFeed:!1,prefetch:!1,appendOnPrefetch:!1,trackItemTransitions:!0,itemTransitionOffset:"50%",onItemTransition:function(a,b,c){}},b.prototype.init=function(){return this.config.trackItemTransitions&&this.trackItemTransitions(a(this.config.itemSelector)),this.config.prefetch&&this.config.appendOnPrefetch?void this.loadItems():(this.config.prefetch&&this.getItems(),void this.trackLoadNewItems())},b.prototype.trackLoadNewItems=function(){var b=this;a(this.config.triggerSelector).waypoint({group:"load_items",handler:function(){this.destroy(),b.loadItems()},offset:this.config.triggerOffset})},b.prototype.trackItemTransitions=function(a){var b=this;a.waypoint({group:"item_transitions",handler:function(a){var c="down"===a?this.previous():this,d="down"===a?this:this.previous(),e=c?c.element:null,f=d?d.element:null;b.config.onItemTransition(e,f,a)},offset:this.config.itemTransitionOffset})},b.prototype.loadItems=function(){var b=this;this.$container.addClass(this.config.loadingClass),this.getItems(function(c){var d=[];c.length>0&&(d=b.append(c),b.trackLoadNewItems()),b.config.onComplete(b.cycle,a(d)),b.$container.removeClass(b.config.loadingClass),b.cycle++})},b.prototype.getItems=function(b){function c(b){var c;b=b||a.noop,d.config.dripFeed?c=d.items.length>d.cycle?[d.items[d.cycle]]:[]:(c=d.items,d.items=[]),b(c)}var d=this;0===this.items.length?this.remoteGet(function(){c(b)}):c(b)},b.prototype.remoteGet=function(b){var c=this,d=[],e=this.config.filterResponse,f=a.extend(!0,{},this.config.request);b=b||a.noop,this.config.request.paged&&(f.data=f.data||{},f.data[this.config.request.offsetParam]=this.cycle*this.config.request.limit+this.config.request.offset,f.data[this.config.request.limitParam]=this.config.request.limit),f.success=function(a){d=e(a)},f.complete=[],f.complete.push(function(){c.items=d}),f.complete.push(b),a.ajax(f)},b.prototype.append=function(b){var c=[];if(b.length>0)for(var d=0;d<b.length;d++){var e=a(this.config.renderTemplate(this.template,b[d]));this.$container.append(e),this.config.onAppend(e),this.config.trackItemTransitions&&this.trackItemTransitions(e),c.push(e)}return c},void(window.Seamless=b))}(jQuery);