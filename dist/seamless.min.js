"use strict";function Seamless(a){checkForDependencies()&&(this.config=$.extend(!0,{},this.defaults,a),this.cycle=0,this.items=[],this.$container=$(this.config.containerSelector),this.template=this.config.compileTemplate(this.config.template))}const $=require("jquery"),Waypoint=require("waypoints/src/waypoint");Seamless.prototype.defaults={containerSelector:".container",itemSelector:".item",triggerSelector:".item:last",triggerOffset:"bottom-in-view",loadingClass:"is-loading",template:"",compileTemplate:function(a){return a},renderTemplate:function(a,b){},onAppend:function(a){},request:{paged:!1,offsetParam:"offset",offset:0,limitParam:"limit",limit:10},filterResponse:function(a){return a},dripFeed:!1,prefetch:!1,appendOnPrefetch:!1,trackItemTransitions:!0,itemTransitionOffset:"50%",onItemTransition:function(a,b,c){}},Seamless.prototype.init=function(){return this.config.trackItemTransitions&&this.trackItemTransitions($(this.config.itemSelector)),this.config.prefetch&&this.config.appendOnPrefetch?void this.loadItems():(this.config.prefetch&&this.getItems(),void this.trackLoadNewItems())},Seamless.prototype.trackLoadNewItems=function(){var a=this;new Waypoint({element:document.querySelector(this.config.triggerSelector),group:"load_items",handler:function(){this.destroy(),a.loadItems()},offset:this.config.triggerOffset})},Seamless.prototype.trackItemTransitions=function(a){var b=this;new Waypoint({element:a.get(0),group:"item_transitions",handler:function(a){var c="down"===a?this.previous():this,d="down"===a?this:this.previous(),e=c?c.element:null,f=d?d.element:null;b.config.onItemTransition(e,f,a)},offset:this.config.itemTransitionOffset})},Seamless.prototype.loadItems=function(){var a=this;this.$container.addClass(this.config.loadingClass),this.getItems(function(b){b.length>0&&(a.append(b),a.trackLoadNewItems()),a.$container.removeClass(a.config.loadingClass),a.cycle++})},Seamless.prototype.getItems=function(a){function b(a){var b;a=a||$.noop,c.config.dripFeed?b=c.items.length>c.cycle?[c.items[c.cycle]]:[]:(b=c.items,c.items=[]),a(b)}var c=this;0===this.items.length?this.remoteGet(function(){b(a)}):b(a)},Seamless.prototype.remoteGet=function(a){var b=this,c=[],d=this.config.filterResponse,e=$.extend(!0,{},this.config.request);a=a||$.noop,this.config.request.paged&&(e.data=e.data||{},e.data[this.config.request.offsetParam]=this.cycle*this.config.request.limit+this.config.request.offset,e.data[this.config.request.limitParam]=this.config.request.limit),e.success=function(a){c=d(a)},e.complete=[],e.complete.push(function(){b.items=c}),e.complete.push(a),$.ajax(e)},Seamless.prototype.append=function(a){if(a.length>0)for(var b=0;b<a.length;b++){var c=$(this.config.renderTemplate(this.template,a[b]));this.$container.append(c),this.config.onAppend(c),this.config.trackItemTransitions&&this.trackItemTransitions(c)}};const checkForDependencies=function(){return"undefined"==typeof $&&"console"in window?(window.console.info("Seamless needs jQuery."),!1):!("undefined"==typeof Waypoint&&"console"in window)||(window.console.info("Seamless needs Waypoints."),!1)};module.exports=Seamless;